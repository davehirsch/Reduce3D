//// =================================================================================//	CSettingsWindow.cp					// =================================================================================//	CSettingsWindow.h	#include "CSettingsWindow.h"#include "CHelpAttach.h"#include <LCheckBox.h>#include <LCheckBoxGroupBox.h>#include <LEditText.h>#include <LPopupButton.h>#include <LMultiPanelView.h>#include "myLFileStream.h"// ---------------------------------------------------------------------------------//		¥ CSettingsWindow// ---------------------------------------------------------------------------------CSettingsWindow::CSettingsWindow(){	mCurrentPanel = nil;	mPrefs = nil;	mTheApp = nil;	mCurrentPanel = nil;	mTabPanel = nil;	mPanelHost = nil;	mCSDPanel = nil;	mStatsPanel = nil;	mEnvelopesPanel = nil;	mOutputPanel = nil;	mMiscPanel = nil;	mShavePanel = nil;}// ---------------------------------------------------------------------------------//		¥ CSettingsWindow(PP::LStream *)// ---------------------------------------------------------------------------------CSettingsWindow::CSettingsWindow(	PP::LStream *inStream )		: PP::LWindow( inStream ){	mCurrentPanel = nil;	mPrefs = nil;	mTheApp = nil;	mCurrentPanel = nil;	mTabPanel = nil;	mPanelHost = nil;	mCSDPanel = nil;	mStatsPanel = nil;	mEnvelopesPanel = nil;	mOutputPanel = nil;	mMiscPanel = nil;	mShavePanel = nil;}// ---------------------------------------------------------------------------------//		¥ ~CSettingsWindow// ---------------------------------------------------------------------------------CSettingsWindow::~CSettingsWindow(){	if (mPrefs) {		delete mPrefs;		mPrefs = nil;	}}// ---------------------------------------------------------------------------------//		¥ FinishCreateSelf// ---------------------------------------------------------------------------------voidCSettingsWindow::FinishCreateSelf(){												// Find the tab panel so that we can get setup to												// listen to it	ThrowIfNil_(mTabPanel =  (PP::LTabsControl*) FindPaneByID ( item_TabsPanel ));	ThrowIfNil_(mPanelHost = (PP::LPlaceHolder*) FindPaneByID ( item_Placeholder ));	if ( mTabPanel ) {		mTabPanel->StartBroadcasting ();		mTabPanel->AddListener ( this );	}												// make all the panel views	ThrowIfNil_(mCSDPanel = PP::UReanimator::CreateView	(rPPob_CSD,	mPanelHost, this));	ThrowIfNil_(mStatsPanel = PP::UReanimator::CreateView	(rPPob_Stats,	mPanelHost, this));	ThrowIfNil_(mEnvelopesPanel = PP::UReanimator::CreateView	(rPPob_Envelopes,	mPanelHost, this));	ThrowIfNil_(mOutputPanel = PP::UReanimator::CreateView	(rPPob_Output,	mPanelHost, this));	ThrowIfNil_(mMiscPanel = PP::UReanimator::CreateView	(rPPob_Misc,	mPanelHost, this));	ThrowIfNil_(mShavePanel = PP::UReanimator::CreateView	(rPPob_Shave,	mPanelHost, this));				// Make the MultiPanelView Listen to the Toggle button	PP::LCheckBox *theCB = (PP::LCheckBox *) mShavePanel->FindPaneByID(item_AspectRatioToggle);	theCB->AddListener(this);	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_InflateBBox);	theCB->AddListener(this);	theCB = (PP::LCheckBox *) mShavePanel->FindPaneByID(item_ShaveSaveCB);	theCB->AddListener(this);	PP::LCheckBoxGroupBox *theCBGB = (PP::LCheckBoxGroupBox *) mShavePanel->FindPaneByID(item_DoShave);	theCBGB->AddListener(this);	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_OutputSigmas);	theCB->AddListener(this);	mTheXYZPopup = mShavePanel->FindPaneByID(item_XYZPopup);	mMaxAR_ET = mShavePanel->FindPaneByID(item_MaxAspRatioET);	mMaxAR_ST = mShavePanel->FindPaneByID(item_MaxAspRatioST);													// Install the CSD panel into the tab panel	mPanelHost->InstallOccupant(mCSDPanel);	mCSDPanel->Show();	mTabPanel->Refresh();											// Setup our reference to the new sample panel	mCurrentPanel = mCSDPanel;	PP::LControl *theCtrl = (PP::LControl *) FindPaneByID(item_OK);	theCtrl->AddListener(this);	PP::LPushButton *theBtn = (PP::LPushButton *) FindPaneByID(item_OK);//	theBtn->SetDefaultButton(true, true);	theCtrl = (PP::LControl *) FindPaneByID(item_Cancel);	theCtrl->AddListener(this);	theCtrl = (PP::LControl *) FindPaneByID(item_RestoreDefaults);	theCtrl->AddListener(this);		theCtrl = (PP::LControl *) mMiscPanel->FindPaneByID(item_LoadHoles);	theCtrl->AddListener(this);	theCtrl = (PP::LControl *) mMiscPanel->FindPaneByID(item_ResetHolesFile);	theCtrl->AddListener(this);	theCtrl = (PP::LControl *) mOutputPanel->FindPaneByID(item_Confidence);	theCtrl->AddListener(this);	AddHelpBalloons();}// ---------------------------------------------------------------------------------//		¥ AddHelpBalloons()// ---------------------------------------------------------------------------------voidCSettingsWindow::AddHelpBalloons(){    PP::LPane* 	thisPane;        thisPane = mStatsPanel->FindPaneByID(item_SampleShape);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_SampleShape));    thisPane = mStatsPanel->FindPaneByID(item_DiscardNegs);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_DiscardNegs));    thisPane = mStatsPanel->FindPaneByID(item_InflateBBox);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_InflateBBox));    thisPane = mEnvelopesPanel->FindPaneByID(item_ObservabiltyFilter);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_ObservabiltyFilter));    thisPane = mEnvelopesPanel->FindPaneByID(item_matchVF);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_matchVF));    thisPane = mEnvelopesPanel->FindPaneByID(item_matchPDF);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_matchPDF));    thisPane = mEnvelopesPanel->FindPaneByID(item_makeDCEnv);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_makeDCEnv));    thisPane = mOutputPanel->FindPaneByID(item_OutputSigmas);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_OutputSigmas));    thisPane = mMiscPanel->FindPaneByID(item_Verbose);    thisPane->AddAttachment(new CHelpAttach(rPPob_SettingsWindow, help_Verbose));}// ---------------------------------------------------------------------------------//		¥ SetUp// ---------------------------------------------------------------------------------voidCSettingsWindow::SetUp(CReduceApp *inApp, CReducePrefs *inPrefsHolder, PrefStruct *inPrefs, myLFileStream *inSettingsFile){	mTheApp = inApp;	mPrefsHolder = inPrefsHolder;	mPrefs = new PrefStruct;	IOPrefs = inPrefs;	::BlockMove(inPrefs, mPrefs, sizeof(PrefStruct));	Boolean useSettingsFile = false;	if (inSettingsFile) {		SInt16 settingsResNum = inSettingsFile->OpenResourceFork(fsRdPerm);		::UseResFile(settingsResNum);		Handle prefs = ::GetResource('pref', 128);		if (prefs != nil) {			PP::LHandleStream theHStream(prefs);			PrefStruct tempPrefs;			inPrefsHolder->ReadPrefsFromStream(theHStream, &tempPrefs);			theHStream.DetachDataHandle();			::ReleaseResource(prefs);			SetValues(&tempPrefs);			useSettingsFile = true;		}		inSettingsFile->CloseResourceFork();	}		if (!useSettingsFile)		SetValues(inPrefs);}// ---------------------------------------------------------------------------------//		¥ SetValues(GraphPrefs *inPrefs)// ---------------------------------------------------------------------------------voidCSettingsWindow::SetValues(PrefStruct *inPrefs){	StopListening();	PP::LCheckBox *theCB;	PP::LCheckBoxGroupBox *theCBGB;	PP::LEditText *theEF;	PP::LPopupButton *thePopup;	PP::LStr255	theLStr;		// CSD Panel	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_MeanCSD);	theCBGB->SetValue(inPrefs->includeMeanCSD);	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_MeanNumClasses);	theEF->SetValue(inPrefs->numClassesMeanCSD);	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_MaxXValue);	theEF->SetDescriptor(FltStr(inPrefs->maxValueMeanCSD, 3));	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_MaxCSD);	theCBGB->SetValue(inPrefs->includeMaxCSD);	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_MaxNumClasses);	theEF->SetValue(inPrefs->numClassesMaxCSD);	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_LogCSD);	theCBGB->SetValue(inPrefs->includeLogCSD);	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_LogNumClasses);	theEF->SetValue(inPrefs->numClassesLogCSD);	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_RegCSD);	theCBGB->SetValue(inPrefs->includeRegCSD);	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_DeltaL);	theEF->SetDescriptor(FltStr(inPrefs->deltaLRegCSD, 3));	// Other Stats Panel	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_DoOtherTests);	theCB->SetValue(inPrefs->doOthers);	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_DoQuadrat);	theCBGB->SetValue(inPrefs->doQuadrat);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_QuadratNumPlacings);	theEF->SetValue(inPrefs->quadratNumPlacings);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_QuadratNumReps);	theEF->SetValue(inPrefs->quadratNumReps);	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_DoRandomPt);	theCBGB->SetValue(inPrefs->doRandomPt);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_RPNumPlacings);	theEF->SetValue(inPrefs->RPNumPlacings);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_RPNumReps);	theEF->SetValue(inPrefs->RPNumReps);	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_ImpingementCrxn);	theCBGB->SetValue(inPrefs->doImpingement);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_MeanErrorTol);	theEF->SetDescriptor(FltStr(inPrefs->impingementMeanErr, 3));	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_MaxErrorTol);	theEF->SetDescriptor(FltStr(inPrefs->impingementMaxErr, 3));	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_DoLMCFPCF);	theCBGB->SetValue(inPrefs->doLMcfPcf);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_NumNNDist);	theEF->SetValue(inPrefs->numNNDist);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_BandwidthOverlap);	theEF->SetValue(inPrefs->overlap);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_NumCFOffsetVolPts);	theEF->SetValue(inPrefs->numCFOffsetVolPts);	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_CvalEpanecnikov);	theEF->SetDescriptor(FltStr(inPrefs->EpanecnikovCVal, 3));	thePopup = (PP::LPopupButton *) mStatsPanel->FindPaneByID(item_SampleShape);	thePopup->SetValue(inPrefs->sampleShape);	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_InflateBBox);	theCB->SetValue(inPrefs->inflateBBox);	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_DiscardNegs);	theCB->SetValue(inPrefs->discardNegs);	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_UseRaeburn);	theCB->SetValue(inPrefs->useRaeburn);	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_UseVolume);	theCB->SetValue(inPrefs->useVolume);	// Envelopes Panel	theCBGB = (PP::LCheckBoxGroupBox *) mEnvelopesPanel->FindPaneByID(item_matchVF);	theCBGB->SetValue(inPrefs->matchVF);	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_VFPercent);	theEF->SetDescriptor(FltStr(inPrefs->VFPercent, 3));	theCB = (PP::LCheckBox *) mEnvelopesPanel->FindPaneByID(item_matchPDF);	theCB->SetValue(inPrefs->matchPDF);	theCB = (PP::LCheckBox *) mEnvelopesPanel->FindPaneByID(item_makeDCEnv);	theCB->SetValue(inPrefs->makeDCEnv);	theCBGB = (PP::LCheckBoxGroupBox *) mEnvelopesPanel->FindPaneByID(item_ObservabiltyFilter);	theCBGB->SetValue(inPrefs->observabilityFilter);	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_Criterion1Factor);	theEF->SetDescriptor(FltStr(inPrefs->crit1Factor, 3));	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_Criterion2Factor);	theEF->SetDescriptor(FltStr(inPrefs->crit2Factor, 3));	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_NumEnvelopeRuns);	theEF->SetValue(inPrefs->numEnvelopeRuns);/*	theCBGB = (PP::LCheckBoxGroupBox *) mEnvelopesPanel->FindPaneByID(item_Make3DModel);	theCBGB->SetValue(inPrefs->make3DModel);	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_NumQD3DEqPts);	theEF->SetValue(inPrefs->numQD3DEqPts);	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_NumQD3DLngPts);	theEF->SetValue(inPrefs->numQD3DLngPts);*/		// Output Panel	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_OutputRED3);	theCB->SetValue(inPrefs->outputReduce);	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_IndXlData);	theCB->SetValue(inPrefs->outputCrystals);	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_R3STT);	theCB->SetValue(inPrefs->outputR3STT);	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_OutputSigmas);	theCB->SetValue(inPrefs->outputSigmas);	theEF = (PP::LEditText *) mOutputPanel->FindPaneByID(item_Confidence);	theEF->SetValue(inPrefs->confidence);	// Misc Panel	thePopup = (PP::LPopupButton *) mMiscPanel->FindPaneByID(item_Greediness);	thePopup->SetValue(inPrefs->greediness);	theEF = (PP::LEditText *) mMiscPanel->FindPaneByID(item_RandomSeed);	theEF->SetValue(inPrefs->seed);	theEF = (PP::LEditText *) mMiscPanel->FindPaneByID(item_MCReps);	theEF->SetValue(inPrefs->MCReps);	theCB = (PP::LCheckBox *) mMiscPanel->FindPaneByID(item_TidyUp);	theCB->SetValue(inPrefs->tidyUp);	theCB = (PP::LCheckBox *) mMiscPanel->FindPaneByID(item_Verbose);	theCB->SetValue(inPrefs->verbose);	theEF = (PP::LEditText *) mMiscPanel->FindPaneByID(item_Discard);	theEF->SetDescriptor(FltStr(inPrefs->discard, 3));	theCB = (PP::LCheckBox *) mMiscPanel->FindPaneByID(item_FixClaude);	theCB->SetValue(inPrefs->fixClaude);	// Shave Panel	theCBGB = (PP::LCheckBoxGroupBox *) mShavePanel->FindPaneByID(item_DoShave);	theCBGB->SetValue(inPrefs->doShave);	theCB = (PP::LCheckBox *) mShavePanel->FindPaneByID(item_AspectRatioToggle);	theCB->SetValue(inPrefs->keepAspectRatios);	thePopup = (PP::LPopupButton *) mShavePanel->FindPaneByID(item_XYZPopup);	thePopup->SetValue(inPrefs->shaveXYZ);	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_MaxAspRatioET);	theEF->SetValue(inPrefs->maxAspectRatio);	if (inPrefs->keepAspectRatios) {	// if turning on		mTheXYZPopup->Deactivate();		mMaxAR_ET->Deactivate();		mMaxAR_ST->Deactivate();	} else {		mTheXYZPopup->Activate();		mMaxAR_ET->Activate();		mMaxAR_ST->Activate();	}	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_IntervalET);	theEF->SetValue(inPrefs->shaveIncrement);	thePopup = (PP::LPopupButton *) mShavePanel->FindPaneByID(item_DirectionPopup);	thePopup->SetValue(inPrefs->direction);	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_MaxPercentET);	theEF->SetValue(inPrefs->minPercent);	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_MinNumberXlsET);	theEF->SetValue(inPrefs->minPopulation);	thePopup = (PP::LPopupButton *) mShavePanel->FindPaneByID(item_SmallerLargerPopup);	thePopup->SetValue(inPrefs->smaller ? menuitem_Smaller : menuitem_Larger);	theCB = (PP::LCheckBox *) mShavePanel->FindPaneByID(item_ShaveSaveCB);	theCB->SetValue(inPrefs->ShaveSave);	StartListening();}// ---------------------------------------------------------------------------//		¥ StoreWindowValues// ---------------------------------------------------------------------------voidCSettingsWindow::StoreWindowValues(PrefStruct *outPrefs){	PP::LCheckBox *theCB;	PP::LCheckBoxGroupBox *theCBGB;	PP::LEditText *theEF;	PP::LPopupButton *thePopup;	PP::LStr255 theLStr;	// CSD Panel	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_MeanCSD);	outPrefs->includeMeanCSD = theCBGB->GetValue();	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_MeanNumClasses);	outPrefs->numClassesMeanCSD = theEF->GetValue();	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_MaxXValue);	theEF->GetDescriptor(theLStr);	outPrefs->maxValueMeanCSD = (double)theLStr;	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_MaxCSD);	outPrefs->includeMaxCSD = theCBGB->GetValue();	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_MaxNumClasses);	outPrefs->numClassesMaxCSD = theEF->GetValue();	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_LogCSD);	outPrefs->includeLogCSD = theCBGB->GetValue();	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_LogNumClasses);	outPrefs->numClassesLogCSD = theEF->GetValue();	theCBGB = (PP::LCheckBoxGroupBox *) mCSDPanel->FindPaneByID(item_RegCSD);	outPrefs->includeRegCSD = theCBGB->GetValue();	theEF = (PP::LEditText *) mCSDPanel->FindPaneByID(item_DeltaL);	theEF->GetDescriptor(theLStr);	outPrefs->deltaLRegCSD = (double)theLStr;	// Other Stats Panel	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_DoOtherTests);	outPrefs->doOthers = theCB->GetValue();	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_DoQuadrat);	outPrefs->doQuadrat = theCBGB->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_QuadratNumPlacings);	outPrefs->quadratNumPlacings = theEF->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_QuadratNumReps);	outPrefs->quadratNumReps = theEF->GetValue();	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_DoRandomPt);	outPrefs->doRandomPt = theCBGB->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_RPNumPlacings);	outPrefs->RPNumPlacings = theEF->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_RPNumReps);	outPrefs->RPNumReps = theEF->GetValue();	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_ImpingementCrxn);	outPrefs->doImpingement = theCBGB->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_MeanErrorTol);	theEF->GetDescriptor(theLStr);	outPrefs->impingementMeanErr = (double)theLStr;	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_MaxErrorTol);	theEF->GetDescriptor(theLStr);	outPrefs->impingementMaxErr = (double)theLStr;	theCBGB = (PP::LCheckBoxGroupBox *) FindPaneByID(item_DoLMCFPCF);	outPrefs->doLMcfPcf = theCBGB->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_NumNNDist);	outPrefs->numNNDist = theEF->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_BandwidthOverlap);	outPrefs->overlap = theEF->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_NumCFOffsetVolPts);	outPrefs->numCFOffsetVolPts = theEF->GetValue();	theEF = (PP::LEditText *) mStatsPanel->FindPaneByID(item_CvalEpanecnikov);	theEF->GetDescriptor(theLStr);	outPrefs->EpanecnikovCVal = (double)theLStr;	thePopup = (PP::LPopupButton *) mStatsPanel->FindPaneByID(item_SampleShape);	outPrefs->sampleShape = thePopup->GetValue();	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_InflateBBox);	outPrefs->inflateBBox = theCB->GetValue();	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_DiscardNegs);	outPrefs->discardNegs = theCB->GetValue();	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_UseRaeburn);	outPrefs->useRaeburn = theCB->GetValue();	theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_UseVolume);	outPrefs->useVolume = theCB->GetValue();	// Envelopes Panel	theCBGB = (PP::LCheckBoxGroupBox *) mEnvelopesPanel->FindPaneByID(item_matchVF);	outPrefs->matchVF = theCBGB->GetValue();	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_VFPercent);	theEF->GetDescriptor(theLStr);	outPrefs->VFPercent = (double)theLStr;	theCB = (PP::LCheckBox *) mEnvelopesPanel->FindPaneByID(item_makeDCEnv);	outPrefs->makeDCEnv = theCB->GetValue();	theCB = (PP::LCheckBox *) mEnvelopesPanel->FindPaneByID(item_matchPDF);	outPrefs->matchPDF = theCB->GetValue();	theCBGB = (PP::LCheckBoxGroupBox *) mEnvelopesPanel->FindPaneByID(item_ObservabiltyFilter);	outPrefs->observabilityFilter = theCBGB->GetValue();	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_Criterion1Factor);	theEF->GetDescriptor(theLStr);	outPrefs->crit1Factor = (double)theLStr;	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_Criterion2Factor);	theEF->GetDescriptor(theLStr);	outPrefs->crit2Factor = (double)theLStr;	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_NumEnvelopeRuns);	outPrefs->numEnvelopeRuns = theEF->GetValue();/*	theCBGB = (PP::LCheckBoxGroupBox *) mEnvelopesPanel->FindPaneByID(item_Make3DModel);	outPrefs->make3DModel = theCBGB->GetValue();	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_NumQD3DEqPts);	outPrefs->numQD3DEqPts = theEF->GetValue();	theEF = (PP::LEditText *) mEnvelopesPanel->FindPaneByID(item_NumQD3DLngPts);	outPrefs->numQD3DLngPts = theEF->GetValue();*/		// Output Panel	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_OutputRED3);	outPrefs->outputReduce = theCB->GetValue();	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_IndXlData);	outPrefs->outputCrystals = theCB->GetValue();	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_R3STT);	outPrefs->outputR3STT = theCB->GetValue();	theCB = (PP::LCheckBox *) mOutputPanel->FindPaneByID(item_OutputSigmas);	outPrefs->outputSigmas = theCB->GetValue();	theEF = (PP::LEditText *) mOutputPanel->FindPaneByID(item_Confidence);	outPrefs->confidence = theEF->GetValue();	// Misc Panel	thePopup = (PP::LPopupButton *) mMiscPanel->FindPaneByID(item_Greediness);	outPrefs->greediness = thePopup->GetValue();	theEF = (PP::LEditText *) mMiscPanel->FindPaneByID(item_RandomSeed);	outPrefs->seed = theEF->GetValue();	theEF = (PP::LEditText *) mMiscPanel->FindPaneByID(item_MCReps);	outPrefs->MCReps = theEF->GetValue();	theCB = (PP::LCheckBox *) mMiscPanel->FindPaneByID(item_TidyUp);	outPrefs->tidyUp = theCB->GetValue();	theCB = (PP::LCheckBox *) mMiscPanel->FindPaneByID(item_Verbose);	outPrefs->verbose = theCB->GetValue();	theEF = (PP::LEditText *) mMiscPanel->FindPaneByID(item_Discard);	theEF->GetDescriptor(theLStr);	outPrefs->discard = (double)theLStr;	theCB = (PP::LCheckBox *) mMiscPanel->FindPaneByID(item_FixClaude);	outPrefs->fixClaude = theCB->GetValue();	// Shave Panel	theCBGB = (PP::LCheckBoxGroupBox *) mShavePanel->FindPaneByID(item_DoShave);	outPrefs->doShave = theCBGB->GetValue();	theCB = (PP::LCheckBox *) mShavePanel->FindPaneByID(item_AspectRatioToggle);	outPrefs->keepAspectRatios = theCB->GetValue();	if (!theCB->GetValue()) {	// do change AR items		thePopup = (PP::LPopupButton *) mShavePanel->FindPaneByID(item_XYZPopup);		outPrefs->shaveXYZ = thePopup->GetValue();		theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_MaxAspRatioET);		outPrefs->maxAspectRatio = theEF->GetValue();	}		// set shared items	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_IntervalET);	outPrefs->shaveIncrement = theEF->GetValue();	thePopup = (PP::LPopupButton *) mShavePanel->FindPaneByID(item_DirectionPopup);	outPrefs->direction = thePopup->GetValue();	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_MaxPercentET);	outPrefs->minPercent = theEF->GetValue();	theEF = (PP::LEditText *) mShavePanel->FindPaneByID(item_MinNumberXlsET);	outPrefs->minPopulation = theEF->GetValue();	thePopup = (PP::LPopupButton *) mShavePanel->FindPaneByID(item_SmallerLargerPopup);	outPrefs->smaller = (thePopup->GetValue() == menuitem_Smaller);	theCB = (PP::LCheckBox *) mShavePanel->FindPaneByID(item_ShaveSaveCB);	outPrefs->ShaveSave = theCB->GetValue();}// ---------------------------------------------------------------------------//		¥ ListenToMessage// ---------------------------------------------------------------------------//	Respond to messages from BroadcastersvoidCSettingsWindow::ListenToMessage(	PP::MessageT	inMessage,	void		*ioParam){	long value = *((long *) ioParam);			// these are for the OK and the Holes buttons	SFTypeList theTL;	theTL[0] = Text_fileType;	theTL[1] = Integrate_bin_fileType;	myLFileStream *tempInFile = nil;		switch (inMessage) {		case PP::msg_OK: {			Hide();			StoreWindowValues(mPrefs);			::BlockMove(mPrefs, IOPrefs, sizeof(PrefStruct));			mPrefsHolder->SavePreferences();			try {				mTheApp->SetInputFileAndProcessData();			} catch (myLFileStream::CancelErr) {				// user canceled file selection dialog; do nothing			} catch (LProgressDialog::StopClicked theStopClickException) {				theStopClickException.theThrower->Hide();				Show();			} catch (CReduceApp::SimulationErr) {				ObeyCommand(PP::cmd_Quit, nil);			}		} break;		case PP::msg_Cancel:			Hide();		break;		case msg_RestoreDefaults: {			ListenToMessage(msg_ResetHoles, nil);			PrefStruct thePrefs;			mPrefsHolder->GetDefaultValues(thePrefs);			SetValues(&thePrefs);			Refresh();		} break;		case msg_LoadHoles: {			try {				tempInFile = new myLFileStream(theTL, 2);				mTheApp->SetHolesFile(tempInFile);				PP::LPushButton *theHolesBtn = (PP::LPushButton *) mMiscPanel->FindPaneByID(item_LoadHoles);				theHolesBtn->SetDescriptor("\pChange Holes File");				PP::LStaticText *theHolesCapt = (PP::LStaticText *) mMiscPanel->FindPaneByID(item_HolesFile);				FSSpec tempSpec = tempInFile->GetSpec();				theHolesCapt->SetDescriptor(tempSpec.name);				delete tempInFile;			} catch (myLFileStream::CancelErr) {				// user canceled file selection dialog; do nothing			}		} break;		case msg_ResetHoles: {			mTheApp->SetHolesFile(nil);			PP::LPushButton *theHolesBtn = (PP::LPushButton *) mMiscPanel->FindPaneByID(item_LoadHoles);			theHolesBtn->SetDescriptor("\pLoad \"Holes\" File");			PP::LStaticText *theHolesCapt = (PP::LStaticText *) mMiscPanel->FindPaneByID(item_HolesFile);			FSSpec tempSpec = tempInFile->GetSpec();			theHolesCapt->SetDescriptor("\pNone Selected");		} break;		case msg_Confidence: {			PP::LEditText *theET = (PP::LEditText *) ioParam;			PP::LStr255 theLStr;			theET->GetDescriptor(theLStr);			short value = (SInt32)theLStr;			short initial = value;			if (value > 100)				value = 100;			else if ((value > 9) && (2*(value/2)) != value)	// then it's odd and bigger than 9				value++;			if (initial != value) {				theLStr = value;				theET->SetDescriptor(theLStr);			}		} break;		case msg_AspectRatioToggle: {			if (value) {	// if turning on				mTheXYZPopup->Deactivate();				mMaxAR_ET->Deactivate();				mMaxAR_ST->Deactivate();			} else {				mTheXYZPopup->Activate();				mMaxAR_ET->Activate();				mMaxAR_ST->Activate();			}		} break;		case msg_DoShave: {	// Shave is incompatible with inflating			PP::LCheckBox *theCB = (PP::LCheckBox *) mStatsPanel->FindPaneByID(item_InflateBBox);			if (value == PP::Button_On)	{ // if turning on shave				StopListening();				theCB->SetValue(PP::Button_Off);				StartListening();				theCB->Deactivate();			} else { // turning off shave				StopListening();				theCB->SetValue(mPrefs->inflateBBox);				StartListening();				theCB->Activate();			}		} break;		case msg_InflateBBox: {	// Inflating is incompatible with shave			PP::LCheckBoxGroupBox *theCBGB = (PP::LCheckBoxGroupBox *) mShavePanel->FindPaneByID(item_DoShave);			if (value == PP::Button_On)	{ // if turning on inflate				StopListening();				theCBGB->SetValue(PP::Button_Off);				StartListening();				theCBGB->Deactivate();			} else { // turning off inflate				StopListening();				theCBGB->SetValue(mPrefs->doShave);				StartListening();				theCBGB->Activate();			}		} break;		case msg_OutputSigmas: {	// if not doing sigmas, must specify confidence level			PP::LEditText *theET = (PP::LEditText *) mOutputPanel->FindPaneByID(item_Confidence);			if (value == PP::Button_On)	{ // if turning on sigmas				StopListening();				theET->Disable();				StartListening();			} else { // turning off inflate				StopListening();				theET->Enable();				StartListening();			}		} break;		case msg_ShaveSaveCB: {	// if we Shave & Save, then we don't do any statistics			if (value == PP::Button_On)	{ // if turning on shave & save				mTabPanel->EnableTab(CSD_index, false);				mTabPanel->EnableTab(Stats_index, false);				mTabPanel->EnableTab(Envelopes_index, false);				mTabPanel->EnableTab(Output_index, false);			} else { // turning off shave & save				mTabPanel->EnableTab(CSD_index, true);				mTabPanel->EnableTab(Stats_index, true);				mTabPanel->EnableTab(Envelopes_index, true);				mTabPanel->EnableTab(Output_index, true);			}		} break;		case item_TabsPanel: {	// panel management			SInt32	panelIndex = *(SInt32 *) ioParam;			switch ( panelIndex ) {				case CSD_index:					UseNewPanel(mCSDPanel);				break;				case Stats_index:					UseNewPanel(mStatsPanel);				break;				case Envelopes_index:					UseNewPanel(mEnvelopesPanel);				break;				case Output_index:					UseNewPanel(mOutputPanel);				break;				case Misc_index:					UseNewPanel(mMiscPanel);				break;				case Shave_index:					UseNewPanel(mShavePanel);				break;			}		} break;	}}// ---------------------------------------------------------------------------//		¥ HandleKeyPress// ---------------------------------------------------------------------------//	Handles keyboard equivalents for hitting the Default and//	Cancel Buttons.////		Default Button: Enter, Return//		Cancel Button:  Escape, Command-PeriodBooleanCSettingsWindow::HandleKeyPress(	const EventRecord	&inKeyEvent){	Boolean		keyHandled = false;	PP::LControl	*keyButton = nil;		switch (inKeyEvent.message & charCodeMask) {			case PP::char_Enter:		case PP::char_Return:			keyButton = (PP::LControl*) FindPaneByID(item_OK);			break;					case PP::char_Escape:			if ((inKeyEvent.message & keyCodeMask) == PP::vkey_Escape) {				keyButton =  (PP::LControl*) FindPaneByID(item_Cancel);			}			break;		default:			if (PP::UKeyFilters::IsCmdPeriod(inKeyEvent)) {				keyButton =  (PP::LControl*) FindPaneByID(item_Cancel);			} else {				keyHandled = PP::LWindow::HandleKeyPress(inKeyEvent);			}			break;	}				if (keyButton != nil) {		keyButton->SimulateHotSpotClick(kControlButtonPart);		keyHandled = true;	}		return keyHandled;}// ---------------------------------------------------------------------------//		¥ UseNewPanel// ---------------------------------------------------------------------------voidCSettingsWindow::UseNewPanel(PP::LView *inView){	mCurrentPanel->Hide();	mPanelHost->InstallOccupant(inView);	inView->Show();	mPanelHost->Refresh();	mCurrentPanel = inView;}